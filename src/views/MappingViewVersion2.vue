<template>
  <div>
    <input type="file" @change="handleFileChange" accept="image/*" />
    <div v-if="imageUrl" style="position: relative; max-width: 70vw;">
      <img :src="imageUrl" alt="Uploaded Image" style="width: 100%; height: auto;" />
      <canvas ref="imageCanvas" style="position: absolute; top: 0; left: 0;"></canvas>
    </div>
    <div v-if="identifications.length">
      <h3>Identifications:</h3>
      <ul>
        <li v-for="(id, index) in identifications" :key="index">
          {{ id }}
          <img :src="croppedImagesDataUrls[index]" alt="Cropped Face" style="width: 100px; height: auto;" />
        </li>

      </ul>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, nextTick } from "vue";
import * as faceapi from "face-api.js";
import Person from "@/stores/types/Person";

const gallery: Person[] = [
  {
    name: "pim",
    descriptor: new Float32Array([
      -0.10913299024105072, 0.11093350499868393, 0.029340090230107307, -0.04312579706311226, -0.10671201348304749, -0.03072541579604149, -0.02832888998091221, -0.17691871523857117, 0.19457662105560303, -0.13764174282550812, 0.29016369581222534, -0.05760956183075905, -0.21470628678798676, -0.13715600967407227, -0.08515673875808716, 0.2330765277147293, -0.20692741870880127, -0.12837669253349304, -0.07834278792142868, -0.03353896737098694, 0.060604579746723175, -0.06046614795923233, 0.05894377455115318, 0.059443242847919464, -0.14089369773864746, -0.36570242047309875, -0.09201212227344513, -0.11114239692687988, -0.06001318246126175, -0.08338309079408646, -0.06204432621598244, 0.09625241160392761, -0.18700732290744781, -0.07825715839862823, -0.036534592509269714, 0.03135323151946068, -0.045352157205343246, -0.036166395992040634, 0.20232343673706055, -0.04236380755901337, -0.23530355095863342, -0.01915084943175316, 0.053719062358140945, 0.2340409755706787, 0.14144033193588257, -0.010207667015492916, 0.029265088960528374, -0.13573509454727173, 0.1182606890797615, -0.16822549700737, -0.014849061146378517, 0.1611848920583725, 0.046493787318468094, 0.04438876733183861, 0.008558421395719051, -0.08600224554538727, 0.011210821568965912, 0.10184480994939804, -0.09612569212913513, -0.033270470798015594, 0.0884471908211708, -0.08496744930744171, -0.08834798634052277, -0.12164279073476791, 0.23248140513896942, 0.1138138547539711, -0.10758671164512634, -0.13737575709819794, 0.131675124168396, -0.08496017009019852, -0.039969366043806076, 0.05635860189795494, -0.18009105324745178, -0.2254437506198883, -0.3058513402938843, -0.03256508708000183, 0.3979005813598633, 0.09565849602222443, -0.15978482365608215, 0.016504675149917603, -0.11697861552238464, -0.006071321666240692, 0.12023334205150604, 0.13506999611854553, -0.0036293098237365484, 0.0679846704006195, -0.08054211735725403, 0.062156278640031815, 0.1693665236234665, -0.09339790046215057, -0.002005854155868292, 0.25746044516563416, 0.0031717789825052023, 0.08296354115009308, -0.010064215399324894, 0.0055496408604085445, -0.06842546164989471, 0.06712862849235535, -0.13494455814361572, 0.049581777304410934, 0.04420316964387894, 0.008942474611103535, 0.005515753757208586, 0.05388646572828293, -0.10475102066993713, 0.0758599117398262, 0.03547637537121773, 0.09015168994665146, 0.029433373361825943, -0.02196892350912094, -0.10528921335935593, -0.1150365024805069, 0.12186271697282791, -0.20080213248729706, 0.141590878367424, 0.15592911839485168, 0.012443074025213718, 0.10665855556726456, 0.11880888044834137, 0.08214298635721207, -0.05437612533569336, -0.05433167517185211, -0.2325219213962555, 0.05831450968980789, 0.15799441933631897, -0.060094792395830154, 0.050012849271297455, -0.030231472104787827
    ]),
  },
  {
    name: "after",
    descriptor: new Float32Array([
      -0.056105826050043106, 0.13399958610534668, 0.0033720475621521473, -0.0037281974218785763, -0.0866502895951271, 0.03636562451720238, -0.0683126449584961, -0.14052529633045197, 0.19795335829257965, -0.13518129289150238, 0.21241503953933716, -0.027045920491218567, -0.2255362570285797, -0.042650483548641205, -0.06107058748602867, 0.16099078953266144, -0.18941466510295868, -0.16856420040130615, -0.06834954768419266, -0.0478631854057312, 0.007580846082419157, -0.02680506370961666, 0.04785871505737305, 0.07146985828876495, -0.09101423621177673, -0.3807976245880127, -0.10744693875312805, -0.12631908059120178, 0.006367554422467947, -0.04547962173819542, -0.15486954152584076, -0.046731069684028625, -0.15495073795318604, -0.05192918702960014, 0.026859460398554802, 0.10772502422332764, -0.038510240614414215, -0.01846235990524292, 0.15244632959365845, 0.04345744475722313, -0.2132153958082199, 0.04589056596159935, 0.03578917309641838, 0.27342918515205383, 0.16521094739437103, 0.12899278104305267, 0.04656403511762619, -0.1607246845960617, 0.11737199872732162, -0.11810755729675293, 0.16049757599830627, 0.1779516190290451, 0.13516277074813843, 0.09673681110143661, 0.06446380168199539, -0.20425885915756226, -0.01998462714254856, 0.11227887123823166, -0.0787571594119072, 0.05691615864634514, 0.08817240595817566, 0.03887324780225754, 0.01905352622270584, -0.0695018395781517, 0.29047954082489014, 0.16222646832466125, -0.12278462201356888, -0.17773199081420898, 0.1603422909975052, -0.15871642529964447, -0.10676119476556778, 0.047388434410095215, -0.14878416061401367, -0.19112463295459747, -0.270000696182251, 0.02757415920495987, 0.4576662480831146, 0.14604149758815765, -0.19766677916049957, -0.044919051229953766, -0.0844774842262268, -0.031019384041428566, 0.12055277824401855, 0.1678442507982254, -0.07455915957689285, 0.0667741671204567, -0.1096455454826355, -0.04539092257618904, 0.2227271944284439, -0.017679553478956223, -0.07462667673826218, 0.18048538267612457, -0.025531068444252014, 0.06037875637412071, 0.046622563153505325, 0.07161892205476761, -0.1403370201587677, 0.05104195326566696, -0.16933321952819824, -0.09109743684530258, -0.007649898529052734, -0.05662613734602928, -0.05438562110066414, 0.07164573669433594, -0.18146634101867676, 0.12596258521080017, -0.004777371883392334, 0.018719544634222984, -0.026887699961662292, 0.06915996968746185, -0.10319729894399643, -0.05492966249585152, 0.178843691945076, -0.2763553857803345, 0.2228146493434906, 0.1872244030237198, 0.08613207936286926, 0.1520017832517624, 0.09779736399650574, 0.11081665754318237, -0.0013198631349951029, -0.055878665298223495, -0.20603735744953156, -0.05915847793221474, 0.030138768255710602, -0.026918498799204826, 0.08321938663721085, 0.05354302376508713
    ]
    ),
  },
  {
    name: "ajKob",
    descriptor: new Float32Array([
      -0.1439763605594635, 0.09503543376922607, 0.07364273816347122,
      -0.0683755949139595, -0.11453810334205627, -0.05753970518708229,
      -0.013790411874651909, -0.15300680696964264, 0.12309187650680542,
      -0.10034848749637604, 0.3551892638206482, -0.013120917603373528,
      -0.19694940745830536, -0.16744419932365417, -0.009050590917468071,
      0.16668257117271423, -0.18567495048046112, -0.08988582342863083,
      -0.1237252950668335, 0.03567185625433922, 0.05068708211183548,
      -0.04842744395136833, 0.08154235035181046, -0.01350212562829256,
      -0.006150001659989357, -0.4367532432079315, -0.13241629302501678,
      -0.045653048902750015, 0.00823921151459217, -0.03335193917155266,
      -0.04625508189201355, 0.028046168386936188, -0.2167389839887619,
      -0.10561688989400864, -0.016281254589557648, 0.03828005492687225,
      -0.012836363166570663, -0.05838679149746895, 0.1266067624092102,
      -0.041218873113393784, -0.2364073544740677, -0.000388296291930601,
      0.04892434924840927, 0.20031282305717468, 0.20080284774303436,
      0.09717551618814468, 0.03688638657331467, -0.10588748008012772,
      0.09205613285303116, -0.19705693423748016, 0.06953136622905731,
      0.11653608083724976, 0.10527440905570984, -0.019339459016919136,
      0.024166325107216835, -0.11837108433246613, 0.02112552523612976,
      0.1177857294678688, -0.09619729965925217, -0.02917547896504402,
      0.10709936171770096, -0.07454213500022888, -0.09514126181602478,
      -0.10411378741264343, 0.23326805233955383, 0.13277707993984222,
      -0.11600944399833679, -0.16013498604297638, 0.13841232657432556,
      -0.08188080042600632, -0.045434437692165375, 0.0300698634237051,
      -0.20908145606517792, -0.21504773199558258, -0.3043603003025055,
      0.0630974993109703, 0.40123313665390015, 0.10544371604919434,
      -0.20032216608524323, -0.033020686358213425, -0.11866071820259094,
      0.07132931798696518, 0.1034376323223114, 0.1192384585738182,
      -0.01935601979494095, -0.002605294808745384, -0.16784459352493286,
      -0.03420103341341019, 0.1801890730857849, -0.08946771919727325,
      -0.01743379607796669, 0.27471908926963806, -0.011910805478692055,
      0.05409181863069534, -0.01283007487654686, -0.00013945916725788265,
      -0.030441448092460632, 0.055898454040288925, -0.1555849313735962,
      0.006012751720845699, 0.0787602961063385, -0.0244121253490448,
      -0.050889745354652405, 0.1017286628484726, -0.15548986196517944,
      0.05758142098784447, -0.02623627334833145, 0.0796625018119812,
      0.07637767493724823, -0.10722464323043823, -0.043753717094659805,
      -0.12232004106044769, 0.07749973982572556, -0.18005195260047913,
      0.17684023082256317, 0.22451721131801605, 0.05132511630654335,
      0.13970667123794556, 0.1314544975757599, 0.10091094672679901,
      0.008457123301923275, -0.032520078122615814, -0.233247309923172,
      -0.001209316193126142, 0.10769043862819672, -0.03749270737171173,
      0.005168521776795387, -0.010343620553612709,
    ]),
  },
  {
    name: "cream",
    descriptor: new Float32Array([
      -0.16385358572006226, 0.09846234321594238, 0.10044314712285995, -0.029065560549497604, -0.11650528758764267, -0.03134383261203766, 0.0122537761926651, -0.10124500095844269, 0.16152691841125488, -0.1242665946483612, 0.2707294225692749, -0.09674033522605896, -0.2725573778152466, -0.0558357909321785, 0.004100714810192585, 0.2026178389787674, -0.16579285264015198, -0.08789876103401184, -0.05741705000400543, -0.02391471341252327, 0.038171734660863876, -0.03195368871092796, 0.05057893320918083, 0.10051994770765305, -0.08670127391815186, -0.4109637439250946, -0.05796331167221069, -0.087616465985775, -0.06940790265798569, -0.0758722573518753, -0.10639099776744843, 0.044453926384449005, -0.1982908844947815, -0.06850144267082214, -0.03371630236506462, 0.058061111718416214, -0.04971989244222641, -0.06543663144111633, 0.19972668588161469, -0.02575044333934784, -0.26144447922706604, 0.00586436502635479, 0.054681744426488876, 0.236846923828125, 0.1493517905473709, 0.04890550300478935, -0.02144593559205532, -0.10069308429956436, 0.11546759307384491, -0.1534077227115631, 0.013398658484220505, 0.15300047397613525, 0.05504041910171509, -0.01616368256509304, -0.012106241658329964, -0.15122102200984955, -0.0362040214240551, 0.06062471494078636, -0.14730076491832733, -0.06170358881354332, 0.09203795343637466, -0.11525026708841324, -0.048894573003053665, -0.1806097775697708, 0.2882777154445648, 0.1300085037946701, -0.12361115217208862, -0.1369848996400833, 0.14547786116600037, -0.11814013123512268, -0.014127242378890514, 0.02416529692709446, -0.19817779958248138, -0.18659716844558716, -0.2911945879459381, 0.05205869674682617, 0.3438759446144104, 0.06544819474220276, -0.13451912999153137, 0.02252776175737381, -0.11632072180509567, 0.002332845237106085, 0.061230096966028214, 0.1954517662525177, 0.012912382371723652, 0.03863430395722389, -0.03836282342672348, 0.0005808499990962446, 0.1484840363264084, -0.06844116002321243, -0.0008431107271462679, 0.2086910605430603, -0.01639794185757637, 0.03497099131345749, 0.007299323100596666, -0.060727640986442566, -0.12361478060483932, 0.026984989643096924, -0.1563035398721695, 0.0490301214158535, -0.06613364815711975, -0.07052759826183319, 0.008668413385748863, 0.08188365399837494, -0.20441128313541412, 0.051432494074106216, 0.013723187148571014, 0.005742517299950123, 0.04106439650058746, 0.018587972968816757, -0.11911448836326599, -0.1457427740097046, 0.09130261093378067, -0.258652925491333, 0.17757104337215424, 0.15567852556705475, 0.07086658477783203, 0.14971677958965302, 0.08800049126148224, 0.12583696842193604, -0.027200618758797646, 0.0569077804684639, -0.22121892869472504, 0.03474411740899086, 0.17056192457675934, -0.049380719661712646, 0.08152234554290771, 0.003717954969033599]),
  },
  {
    name: "catherine",
    descriptor: new Float32Array([
      -0.13546611368656158, 0.09657091647386551, 0.055674269795417786, -0.06191183999180794, -0.05304916948080063, -0.03512436896562576, 0.040184929966926575, -0.057448673993349075, 0.12883225083351135, -0.06801667809486389, 0.31024929881095886, -0.05945739895105362, -0.21502496302127838, -0.11756312102079391, 0.04532106593251228, 0.17161792516708374, -0.14951074123382568, -0.08613935858011246, -0.10479507595300674, -0.003906873520463705, -0.0032350921537727118, -0.014001153409481049, 0.04136250168085098, 0.14479300379753113, -0.04236684739589691, -0.3636223375797272, -0.07289968430995941, -0.09500523656606674, -0.020343726500868797, -0.08100753277540207, -0.06944815069437027, 0.10567983984947205, -0.17268936336040497, -0.05270221084356308, -0.0042139701545238495, 0.0486469529569149, -0.014147067442536354, -0.022708062082529068, 0.22650502622127533, 0.02092178352177143, -0.22201251983642578, -0.029135452583432198, 0.022180408239364624, 0.3100712299346924, 0.19831939041614532, -0.015878427773714066, -0.011897791177034378, -0.039731718599796295, 0.062084853649139404, -0.1939435452222824, -0.0038102040998637676, 0.14783596992492676, 0.07374634593725204, 0.005785902496427298, -0.0013898878823965788, -0.11408815532922745, -0.034675486385822296, 0.09470159560441971, -0.13771575689315796, -0.04355025291442871, -0.011758016422390938, -0.14329563081264496, -0.04212350770831108, -0.15973632037639618, 0.31289470195770264, 0.08163220435380936, -0.15526333451271057, -0.14453722536563873, 0.1304137408733368, -0.11507998406887054, -0.024825867265462875, 0.12549495697021484, -0.18352463841438293, -0.1602565199136734, -0.31881457567214966, 0.08599243313074112, 0.3631420433521271, 0.09341055154800415, -0.2025735229253769, 0.016721190884709358, -0.1768864542245865, -0.060053955763578415, 0.020278647541999817, 0.15512564778327942, -0.03189663589000702, 0.05609379708766937, -0.08803151547908783, -0.022536952048540115, 0.17439129948616028, -0.03171493113040924, -0.0022615534253418446, 0.2497488558292389, -0.012265602126717567, 0.015368402935564518, 0.018578361719846725, -0.04261820390820503, -0.045006971806287766, -0.053357623517513275, -0.1689932644367218, -0.02559264376759529, -0.06087314337491989, -0.11154618859291077, -0.022339431568980217, 0.12329414486885071, -0.24880358576774597, 0.05920858308672905, 0.021852852776646614, -0.01781436987221241, 0.022356899455189705, 0.019301339983940125, -0.08741939812898636, -0.149028941988945, 0.13185977935791016, -0.27370426058769226, 0.08979440480470657, 0.17341481149196625, 0.10743629187345505, 0.11236613243818283, 0.06692947447299957, 0.10680856555700302, -0.08366969227790833, -0.010839059948921204, -0.1450890153646469, 0.054392699152231216, 0.1650058925151825, -0.01756461150944233, 0.05639650300145149, -0.018122902140021324
    ])
  },
  {
    name: "toey",
    descriptor: new Float32Array([
      -0.09441986680030823, 0.021994100883603096, 0.02433912828564644, -0.06464385986328125, -0.07549025863409042, -0.06735651940107346, -0.018108801916241646, -0.15328264236450195, 0.20860736072063446, -0.14642980694770813, 0.2638152539730072, -0.014765040017664433, -0.20309783518314362, -0.07873227447271347, 0.00911412201821804, 0.16544882953166962, -0.18896731734275818, -0.1271512508392334, -0.014250051230192184, -0.07433731853961945, 0.05067671462893486, -0.04987507686018944, 0.09800078719854355, 0.12433791160583496, -0.14627429842948914, -0.3269656002521515, -0.14277219772338867, -0.23080238699913025, -0.02470318414270878, -0.019685102626681328, -0.02864096313714981, 0.08889852464199066, -0.17868778109550476, -0.04061243683099747, -0.0069382633082568645, 0.0542169027030468, 0.014513994567096233, -0.06165927276015282, 0.2183186560869217, -0.0164067093282938, -0.2209189236164093, -0.13265545666217804, 0.01880367286503315, 0.20101910829544067, 0.13631954789161682, -0.009879980236291885, 0.05017527565360069, -0.03762830048799515, 0.07621897757053375, -0.13299429416656494, 0.02156173065304756, 0.08796829730272293, 0.06778636574745178, -0.004347916692495346, -0.001573637593537569, -0.1652982383966446, 0.0423632375895977, 0.05778280273079872, -0.17563438415527344, -0.050288911908864975, 0.053941722959280014, -0.1288074553012848, -0.08053549379110336, -0.04419955983757973, 0.31707963347435, 0.14919988811016083, -0.11695841699838638, -0.11816509813070297, 0.20238834619522095, -0.14052125811576843, -0.02172781154513359, 0.07456155866384506, -0.23069122433662415, -0.1561330258846283, -0.2835271656513214, -0.044316526502370834, 0.4598447382450104, 0.02644648402929306, -0.12870629131793976, 0.036548513919115067, -0.13238196074962616, -0.010755306109786034, 0.07445656508207321, 0.14152608811855316, -0.004866763949394226, 0.07383713871240616, -0.07857799530029297, 0.011197292245924473, 0.18094490468502045, -0.08433108776807785, -0.027283119037747383, 0.15365387499332428, -0.06137681007385254, 0.04795655235648155, 0.05469586327672005, -0.013030788861215115, -0.03822437673807144, -0.007231463678181171, -0.12897926568984985, 0.049674149602651596, -0.07406757026910782, -0.04729337990283966, -0.06339512765407562, 0.04934979975223541, -0.1842050403356552, 0.025715725496411324, 0.04306545481085777, -0.07501430809497833, -0.06060877814888954, -0.007315203081816435, -0.1504317671060562, -0.12684325873851776, 0.15775230526924133, -0.23037390410900116, 0.1292649209499359, 0.16953034698963165, 0.04465905576944351, 0.18202024698257446, 0.02367524616420269, 0.10042719542980194, -0.07305703312158585, -0.052486859261989594, -0.23737840354442596, 0.019347090274095535, 0.13004998862743378, -0.05248023569583893, 0.055407844483852386, -0.032776135951280594]),
  },
  {
    name: "minnie",
    descriptor: new Float32Array([
      -0.10112086683511734, 0.0450393483042717, 0.0560474768280983, -0.06778901815414429, -0.08910068869590759, -0.04587315395474434, -0.05536419898271561, -0.13649003207683563, 0.20766229927539825, -0.13070321083068848, 0.26236656308174133, -0.133335143327713, -0.19165733456611633, -0.11726388335227966, -0.024101700633764267, 0.2533053755760193, -0.20617052912712097, -0.16536511480808258, -0.05443781614303589, 0.007044712081551552, 0.03576350212097168, -0.04035407304763794, 0.01671673357486725, 0.10053835809230804, -0.13651897013187408, -0.431919664144516, -0.10954586416482925, -0.11666537821292877, -0.0918923169374466, -0.0918111577630043, -0.07842165976762772, 0.0638837143778801, -0.19088061153888702, -0.06875493377447128, -0.02517077885568142, 0.07479946315288544, -0.033246684819459915, -0.09101536124944687, 0.1409274935722351, 0.0032028176356106997, -0.31031760573387146, 0.005936672445386648, 0.048457060009241104, 0.20595644414424896, 0.16609816253185272, 0.03184301406145096, 0.009956895373761654, -0.16563859581947327, 0.10891495645046234, -0.17962612211704254, -0.022203166037797928, 0.13259263336658478, 0.022111693397164345, 0.039033010601997375, -0.02380938082933426, -0.09759319573640823, -0.008443798869848251, 0.09065639972686768, -0.2101162225008011, -0.028458988294005394, 0.07487327605485916, -0.08964262157678604, -0.0639822855591774, -0.14042799174785614, 0.22712907195091248, 0.2044944167137146, -0.13775864243507385, -0.16087980568408966, 0.11791329085826874, -0.14224299788475037, -0.0460841991007328, 0.0816916972398758, -0.15316171944141388, -0.24480949342250824, -0.34821566939353943, -0.04932580143213272, 0.42052191495895386, 0.044591695070266724, -0.18006329238414764, -0.037599749863147736, -0.06720882654190063, 0.005098617635667324, 0.11923806369304657, 0.1980995088815689, 0.03005922958254814, 0.048756882548332214, -0.06922324001789093, 0.033241644501686096, 0.1829434335231781, -0.06868533045053482, -0.00266172643750906, 0.20101553201675415, -0.045686159282922745, 0.0914178341627121, -0.009004016406834126, 0.10572262108325958, -0.08313117176294327, 0.07505171746015549, -0.12459547072649002, 0.029821179807186127, 0.002845966489985585, 0.05082129314541817, -0.0008088584872893989, 0.050490591675043106, -0.08530419319868088, 0.12266827374696732, 0.049005016684532166, 0.013676980510354042, 0.010212661698460579, -0.013621749356389046, -0.039625804871320724, -0.10027829557657242, 0.11965860426425934, -0.22593535482883453, 0.13769948482513428, 0.16267427802085876, 0.024395445361733437, 0.14539112150669098, 0.04706710949540138, 0.10720430314540863, -0.10485634207725525, -0.07062792032957077, -0.2504097819328308, 0.06383736431598663, 0.09357594698667526, -0.01619087904691696, 0.08465157449245453, -0.02998638153076172
    ]),
  },
];
const croppedImagesDataUrls = ref([]);

const imageUrl = ref<string | null>(null);
const identifications = ref<string[]>([]);
const imageCanvas = ref<HTMLCanvasElement | null>(null);

async function loadModels() {
  await Promise.all([
    faceapi.nets.ssdMobilenetv1.loadFromUri("/models"),
    faceapi.nets.faceLandmark68Net.loadFromUri("/models"),
    faceapi.nets.faceRecognitionNet.loadFromUri("/models"),
  ]);
}

onMounted(async () => {
  await loadModels();
});
const handleFileChange = async (event: any) => {
  const { files } = event.target;
  if (!files || !files.length) return;

  imageUrl.value = URL.createObjectURL(files[0]);
  await nextTick();

  const imageElement = new Image();
  imageElement.onload = async () => {
    if (imageCanvas.value) {
      const canvas = imageCanvas.value;
      canvas.width = imageElement.naturalWidth;
      canvas.height = imageElement.naturalHeight;


      const ctx = canvas.getContext("2d");
      const displaySize = { width: imageElement.naturalWidth, height: imageElement.naturalHeight };
      faceapi.matchDimensions(canvas, displaySize);

      const detections = await faceapi.detectAllFaces(imageElement, new faceapi.SsdMobilenetv1Options()).withFaceLandmarks().withFaceDescriptors();
      const resizedDetections = faceapi.resizeResults(detections, displaySize);
      canvas.style.width = '100%';
      canvas.style.height = 'auto';
      canvas.style.position = 'absolute';
      canvas.style.top = '0';
      canvas.style.left = '0';
      ctx!.clearRect(0, 0, canvas.width, canvas.height);
      faceapi.draw.drawDetections(canvas, resizedDetections);
      faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);

      identifications.value = [];
      croppedImagesDataUrls.value = [];

      const faceMatcher = new faceapi.FaceMatcher(gallery.map(person => new faceapi.LabeledFaceDescriptors(person.name, [person.descriptor])));

      resizedDetections.forEach((detection, index) => {
        const bestMatch = faceMatcher.findBestMatch(detection.descriptor);
        const name = bestMatch.toString().split(" ")[0];
        identifications.value.push(name);

        const box = detection.detection.box;
        const cropCanvas = document.createElement('canvas');
        cropCanvas.width = box.width;
        cropCanvas.height = box.height;
        const cropCtx = cropCanvas.getContext('2d');
        cropCtx!.drawImage(imageElement, box.x, box.y, box.width, box.height, 0, 0, box.width, box.height);
        const croppedImageUrl = cropCanvas.toDataURL();
        croppedImagesDataUrls.value.push(croppedImageUrl);
      });
    }
  };
  imageElement.src = imageUrl.value;
};
const identifyFacesInScene = (sceneDescriptors: Float32Array[]) => {
  const labeledFaceDescriptors = gallery.map(
    (person) =>
      new faceapi.LabeledFaceDescriptors(person.name, [person.descriptor])
  );
  const faceMatcher = new faceapi.FaceMatcher(labeledFaceDescriptors);
  //set identifications and persent to the user
  identifications.value = sceneDescriptors.map((descriptor) => {
    const bestMatch = faceMatcher.findBestMatch(descriptor);
    return bestMatch.toString().split(" ")[0]; // Assuming the name is the first part of the string
  });
  return sceneDescriptors.map((descriptor) => {
    const bestMatch = faceMatcher.findBestMatch(descriptor);
    return bestMatch.toString().split(" ")[0]; // Assuming the name is the first part of the string
  });
};
</script>
